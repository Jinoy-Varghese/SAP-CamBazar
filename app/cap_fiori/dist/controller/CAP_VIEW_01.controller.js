sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/m/MessageToast"],function(e,t,i,o,n,r,s,a,l){"use strict";return e.extend("capfiori.controller.CAP_VIEW_01",{onInit:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("Routelist_view_01").attachPatternMatched(this._onObjectMatched,this);var t=new o;this.getView().setModel(t,"userModel")},_onObjectMatched:function(e){var t=e.getParameter("arguments").name;var i=e.getParameter("arguments").pass;var o=this.getView().getModel("userModel");o.setProperty("/username",t);o.setProperty("/password",i)},alertButton:function(){let e=this.getView().byId("input0").getValue();let i=this.getView().byId("input1").getValue();t.success("Username : "+e+" \nPassword : "+i)},onNavigateToList:function(){let e=this.getView().byId("input0").getValue();let i=this.getView().byId("input1").getValue();if(e===""||i===""){t.error("Invalid Username/Password")}else{var o=this.getOwnerComponent().getModel();let n=[new r("username",s.EQ,e),new r("password",s.EQ,i)];let a=o.bindList("/users");a.filter(n);a.requestContexts().then(o=>{if(o.length>0){o.forEach(e=>{let t=e.getObject();console.log("User found:",t)});sessionStorage.setItem("loggedIn","true");var n=sap.ui.core.UIComponent.getRouterFor(this);n.navTo("Routelist_view_01",{name:e,pass:i})}else{t.error("Invalid Username/Password")}}).catch(e=>{console.error("Error fetching data: ",e);t.error("An error occurred while fetching data. Please try again.")})}},logout:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);t.confirm("Are you sure, you want to logout?",{actions:[t.Action.OK,t.Action.CANCEL],onClose:function(i){if(i===t.Action.OK){sessionStorage.removeItem("loggedIn");e.navTo("RouteCAP_VIEW_01")}}})},openPolicyDoc:function(){var e=this.getView();if(!this.byId("frag1")){i.load({id:e.getId(),name:"capfiori.view.policyDoc",controller:this}).then(function(t){e.addDependent(t);t.open()})}else{this.byId("frag1").open()}},closePolicyDoc:function(){this.byId("frag1").close()},onCollapseExpandPress(){const e=this.byId("sideNavigation"),t=e.getExpanded();e.setExpanded(!t)},hideAllPanels:function(){var e=this.getView();e.byId("Panel1").setVisible(false);e.byId("Panel2").setVisible(false);e.byId("Panel3").setVisible(false);e.byId("Panel4").setVisible(false);e.byId("Panel5").setVisible(false);e.byId("Panel6").setVisible(false);e.byId("Panel7").setVisible(false)},onAboutPress:function(){this.hideAllPanels();var e=this.byId("Panel1");e.setVisible(true)},onListPress:function(){this.hideAllPanels();var e=this.byId("Panel2");e.setVisible(true)},onHomePress:function(){this.hideAllPanels();var e=this.byId("Panel3");e.setVisible(true)},viewOrders:function(){this.hideAllPanels();var e=this.byId("Panel4");e.setVisible(true)},add_item:function(){this.hideAllPanels();var e=this.byId("Panel5");e.setVisible(true)},update_item:function(){this.hideAllPanels();var e=this.byId("Panel6");e.setVisible(true)},purchaseList:function(){this.hideAllPanels();var e=this.byId("Panel7");e.setVisible(true)},profile_dropdown:function(){var e=this.getView(),t=e.byId("profile_button");if(!this._oMenuFragment){this._oMenuFragment=i.load({id:e.getId(),name:"capfiori.view.profile_dropdown",controller:this}).then(function(e){e.openBy(t);this._oMenuFragment=e;return this._oMenuFragment}.bind(this))}else{this._oMenuFragment.openBy(t)}},onSearch:function(e){var t=this.byId("ordersTable");var i=t.getBinding("items");var o=this.byId("orderIdInput").getValue();var n=[];if(o){n.push(new r("OrderID",s.Contains,o))}i.filter(n)},onRefresh:function(){var e=this.byId("ordersTable").getBinding("items");if(e.hasPendingChanges()){t.error("Before refreshing, please save or revert your changes");return}e.refresh();l.show("Data Refreshed")},onSearch:function(){var e=this.getView(),t=e.byId("searchField").getValue();if(t){var i=new r("title",s.Contains,t);e.byId("ordersTable").getBinding("items").filter(i,a.Application)}else{e.byId("ordersTable").getBinding("items").filter([])}},add_item_data:function(){var e=this.getView().byId("cam_code").getValue();var i=this.getView().byId("item_name").getValue();var o=this.getView().byId("stock").getValue();var n=this.getView().byId("Item_Price").getValue();var r=this.getView().byId("fileUploader");console.log("FileUploader:",r);var s=r.getDomRef().querySelector("input[type='file']");var a=s.files;console.log("Selected files:",a);if(!a||a.length===0){t.error("Please select a file to upload.");return}var l=new FormData;l.append("file",a[0]);fetch("/upload",{method:"POST",body:l}).then(e=>e.json()).then(s=>{console.log("File uploaded successfully:",s);var a=this.getView().getModel();var l=a.bindList("/Books").create({ID:e,title:i,author_ID:n,stock:o,attachments:[{file_url:s.file_url}],status:"L",active_status:"Y"});l.created().then(()=>{t.success("Product Added Successfully");this.getView().byId("cam_code").setValue(null);this.getView().byId("item_name").setValue(null);this.getView().byId("stock").setValue(null);this.getView().byId("Item_Price").setValue(null);r.clear()}).catch(e=>{console.error("Error adding book: ",e);t.error("An error occurred while adding the book. Please try again.")})}).catch(e=>{console.error("Error uploading file:",e);t.error("An error occurred while uploading the file. Please try again.")})},onActionPress:function(e){var t=e.getSource();var o=t.getBindingContext();this._oSelectedContext=o;if(!this._oActionSheet){i.load({id:this.getView().getId(),name:"capfiori.view.ActionSheet",controller:this}).then(function(e){this._oActionSheet=e;this.getView().addDependent(this._oActionSheet);this._oActionSheet.openBy(t)}.bind(this))}else{this._oActionSheet.openBy(t)}},formatFileName:function(e){console.log("Attachments:",e);if(Array.isArray(e)&&e.length>0){var t=e[0];console.log("file properties:",Object.keys(t));if(t.file_url){return"../../uploads/"+t.file_url.split("/").pop()}}return"no image link"},onViewPress:function(){var e=this.getView();if(!this.byId("viewPopup")){i.load({id:e.getId(),name:"capfiori.view.viewItem",controller:this}).then(function(t){e.addDependent(t);t.setBindingContext(this._oSelectedContext);t.open()}.bind(this))}else{var t=this.byId("viewPopup");t.setBindingContext(this._oSelectedContext);t.open()}},closeViewPopup:function(){this.byId("viewPopup").close()},onEditPress:function(){var e=this._oSelectedContext.getObject();l.show("Edit action for Book ID: "+e.ID);this.update_item();var i=this.getOwnerComponent().getModel();let o=[new r("ID",s.EQ,e.ID)];let n=i.bindList("/Books");n.filter(o);n.requestContexts().then(e=>{if(e.length>0){e.forEach(e=>{let t=e.getObject();console.log("Cam Found in DB:",t);this.getView().byId("update_cam_code").setValue(t.ID);this.getView().byId("update_item_name").setValue(t.title);this.getView().byId("update_stock").setValue(t.stock);this.getView().byId("update_Item_Price").setValue(t.author_ID)})}else{t.error("Invalid ID")}}).catch(e=>{console.error("Error fetching data: ",e);t.error("An error occurred while fetching data. Please try again.")})},onDeletePress:function(){var e=this._oSelectedContext;var i=e.getProperty("ID");t.confirm("Are you sure you want to delete Book ID: "+i+"?",{actions:[t.Action.YES,t.Action.NO],onClose:function(o){if(o===t.Action.YES){e.delete("$direct").then(function(){l.show("Book ID: "+i+" deleted.")}).catch(function(e){t.alert("Could not delete Book: "+e.message,{icon:t.Icon.ERROR,title:"Error"})})}}})},update_item_data:function(){var e=this.getView().byId("update_cam_code").getValue();var i=this.getView().byId("update_item_name").getValue();var o=this.getView().byId("update_stock").getValue();var n=this.getView().byId("update_Item_Price").getValue();var r=this.getView().getModel();var s="/Books('"+e+"')";var a=r.bindContext(s).getBoundContext();var l=this.getView();function d(){l.setBusy(false)}l.setBusy(true);a.setProperty("title",i);a.setProperty("author_ID",n);a.setProperty("stock",o);r.submitBatch("auto").then(function(){d();t.success("Camera Details Successfully updated")}).catch(function(e){d();console.error("Error updating Camera: ",e);t.error("An error occurred while updating the book. Please try again.")})},sendTo:function(){var e=this._oSelectedContext;var i=e.getProperty("ID");t.confirm("Are you sure you want to send "+i+" to Sales ?",{actions:[t.Action.YES,t.Action.NO],onClose:e=>{if(e===t.Action.YES){var o=this.getView().getModel();var n="/Books('"+i+"')";var r=o.bindContext(n).getBoundContext();var s=this.getView();function a(){s.setBusy(false)}s.setBusy(true);r.setProperty("status","P");o.submitBatch("auto").then(function(){a();t.success("Lead Confirmed")}).catch(function(e){a();console.error("Error updating Camera: ",e);t.error("An error occurred while updating the book. Please try again.")})}}})}})});
//# sourceMappingURL=CAP_VIEW_01.controller.js.map